#!/bin/zsh

# Check if the correct number of arguments is provided
if [ "$#" -ne 1 ]; then
  echo "Usage: $0 input.md"
  exit 1
fi

INPUT_FILE=$1
BASENAME=$(basename "$INPUT_FILE" .md)

# Check if the input file exists and is a markdown file
if [ ! -f "$INPUT_FILE" ]; then
  echo "Error: File $INPUT_FILE does not exist."
  exit 1
fi

if [[ "$INPUT_FILE" != *.md ]]; then
  echo "Error: Input file must be a Markdown (.md) file."
  exit 1
fi

# Download the GitHub Markdown CSS if it doesn't already exist
CSS_FILE="github-markdown.css"
if [ ! -f "$CSS_FILE" ]; then
  curl -o "$CSS_FILE" https://raw.githubusercontent.com/sindresorhus/github-markdown-css/main/github-markdown.css
fi

# Convert the Markdown file to HTML using pandoc
HTML_FILE="${BASENAME}.html"
pandoc "$INPUT_FILE" -o "$HTML_FILE" --self-contained --css="$CSS_FILE"

# Convert the HTML file to PDF using LibreOffice
soffice --headless --convert-to pdf "$HTML_FILE"

# Delete the HTML file
rm "$HTML_FILE"

echo "Conversion complete. Output PDF: ${BASENAME}.pdf"

